#!/bin/sh

SELFDIR=$(cd "$(dirname "$0")"; pwd)

# Debugging
echo "" >> /tmp/my-log
echo "invoke: $0" >> /tmp/my-log
echo "pwd: `pwd`" >> /tmp/my-log
echo "SELFDIR: $SELFDIR" >> /tmp/my-log

# Install golang-petname utility to GOBIN
go install github.com/dustinkirkland/golang-petname/cmd/petname@latest

# Generate a unique petname for this machine instance
if [[ ! -f "${HOME}/.machine_name" ]]; then
  $HOME/go/bin/petname > ~/.machine_name
fi

# Install tmux config
cp $SELFDIR/.tmux.conf ~/

cat >> ~/.bashrc << HERE

# hashtagchris/dotfile additions
export PATH=\$PATH:/workspaces/github/bin

# Give each codespace a unique prompt
__custom_bash_prompt() {
    local machinepart="\[\033[0;31m\][SET ~/.machine_name]"
    if [[ -f "${HOME}/.machine_name" ]]; then
        machinepart="\[\033[0;32m\]$(cat ${HOME}/.machine_name)"
    fi

    local returnpart='`export XIT=$? \
        && [ "$XIT" -ne "0" ] && echo -n "\[\033[1;31m\]➜" || echo -n "\[\033[0m\]➜"`'

    local lightblue='\[\033[1;34m\]'
    local removecolor='\[\033[0m\]'
    PS1="${machinepart} ${returnpart} ${lightblue}\w${removecolor} \$ "
    unset -f __custom_bash_prompt
}
__custom_bash_prompt
HERE
